<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= folder.name %> - File Uploader</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .btn { padding: 10px 20px; text-decoration: none; border-radius: 5px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .upload-section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .upload-form { display: flex; gap: 15px; align-items: center; }
        .file-input { flex: 1; }
        .files-list { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee; }
        .file-item:last-child { border-bottom: none; }
        .file-info { flex: 1; }
        .file-name { font-weight: bold; margin-bottom: 5px; }
        .file-meta { color: #666; font-size: 14px; }
        .file-actions { display: flex; gap: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1><%= folder.name %></h1>
                <p><%= folder.files.length %> files</p>
            </div>
            <div>
                <a href="/folders/<%= folder.id %>/edit" class="btn btn-primary">Edit Folder</a>
                <a href="/folders" class="btn btn-secondary">Back to Folders</a>
                <a href="/" class="btn btn-secondary">Dashboard</a>
            </div>
        </div>

        <div class="upload-section">
            <h3>Upload File</h3>
            <form action="/files/upload" method="POST" enctype="multipart/form-data" class="upload-form">
                <input type="hidden" name="folderId" value="<%= folder.id %>">
                <input type="file" name="file" required class="file-input">
                <button type="submit" class="btn btn-primary">Upload</button>
            </form>
        </div>

        <div class="share-section" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 30px;">
            <h3>Share Folder</h3>
            <form id="shareForm" style="display: flex; gap: 15px; align-items: center;">
                <select name="duration" required style="padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="1">1 day</option>
                    <option value="7">7 days</option>
                    <option value="30">30 days</option>
                    <option value="90">90 days</option>
                </select>
                <button type="submit" class="btn btn-primary">Create Share Link</button>
            </form>
            <div id="shareResult" style="margin-top: 15px; display: none;">
                <p><strong>Share Link:</strong> <a id="shareLink" href="" target="_blank"></a></p>
                <p><strong>Expires:</strong> <span id="expiresAt"></span></p>
            </div>
        </div>

        <div class="files-list">
            <h3>Files in this folder</h3>
            <% if (folder.files.length === 0) { %>
                <p>No files in this folder yet. Upload your first file above!</p>
            <% } else { %>
                <% folder.files.forEach(file => { %>
                    <div class="file-item">
                        <div class="file-info">
                            <div class="file-name"><%= file.name %></div>
                            <div class="file-meta">
                                <%= (file.size / 1024 / 1024).toFixed(2) %> MB â€¢ 
                                Uploaded <%= new Date(file.uploadTime).toLocaleDateString() %>
                            </div>
                        </div>
                        <div class="file-actions">
                            <a href="/files/<%= file.id %>" class="btn btn-secondary">View</a>
                            <a href="/files/download/<%= file.id %>" class="btn btn-primary">Download</a>
                            <form action="/files/delete/<%= file.id %>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this file?')">
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                        </div>
                    </div>
                <% }) %>
            <% } %>
        </div>
    </div>

    <script>
        document.getElementById('shareForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const duration = formData.get('duration');
            
            try {
                const response = await fetch(`/share/create/<%= folder.id %>`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ duration: parseInt(duration) })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('shareLink').href = result.shareUrl;
                    document.getElementById('shareLink').textContent = result.shareUrl;
                    document.getElementById('expiresAt').textContent = new Date(result.expiresAt).toLocaleString();
                    document.getElementById('shareResult').style.display = 'block';
                } else {
                    alert('Error creating share link: ' + result.error);
                }
            } catch (error) {
                alert('Error creating share link');
            }
        });
    </script>
</body>
</html>
